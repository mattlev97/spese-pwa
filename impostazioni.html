<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Impostazioni - Gestione Spese</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="theme-color" content="#1e1e1e" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Impostazioni</h1>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="aggiungi.html">Aggiungi</a>
      <a href="archivio.html">Archivio</a>
      <a href="impostazioni.html" class="nav-active">Impostazioni</a>
    </nav>
  </header>

  <main>
    <section class="settings-section">
      <h2>Supermercati</h2>
      <p class="hint">Rimuovi i supermercati che non usi o aggiungine di nuovi. Le modifiche verranno salvate automaticamente.</p>

      <div id="storesContainer" class="stores-list" aria-live="polite"></div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
        <input id="newStoreInput" class="store-input" type="text" placeholder="Aggiungi nuovo supermercato" />
        <button id="addStoreBtn" class="add-store-btn">‚ûï Aggiungi</button>
      </div>

      <div>
        <button id="resetDefaultsBtn" class="btn btn-secondary" style="margin-top:12px;">Ripristina valori predefiniti</button>
        <button id="saveSettingsBtn" class="save-settings-btn">Salva impostazioni</button>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
  <script>
    // impostazioni page logic
    function renderStoresList() {
      const container = document.getElementById('storesContainer');
      container.innerHTML = '';
      const stores = app.getStores();
      if (!stores || stores.length === 0) {
        container.innerHTML = '<div class="no-expenses">Nessun supermercato salvato</div>';
        return;
      }

      stores.forEach((storeName, idx) => {
        const item = document.createElement('div');
        item.className = 'store-item';
        item.dataset.store = storeName;

        const handle = document.createElement('div');
        handle.className = 'store-handle';
        handle.title = 'Trascina per riordinare (non implementato)';
        handle.textContent = '‚â°';

        const input = document.createElement('input');
        input.className = 'store-input';
        input.value = storeName;
        input.readOnly = true;

        const actions = document.createElement('div');
        actions.className = 'store-actions';

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.title = 'Rimuovi';
        removeBtn.innerHTML = 'üóëÔ∏è';
        removeBtn.addEventListener('click', () => {
          if (confirm(`Eliminare "${storeName}" dalla lista dei supermercati?`)) {
            app.removeStore(storeName);
            renderStoresList();
            // aggiorna selects in altre pagine
            app.populateAllStoreSelects();
          }
        });

        actions.appendChild(removeBtn);
        item.appendChild(handle);
        item.appendChild(input);
        item.appendChild(actions);
        container.appendChild(item);
      });
    }

    function addNewStoreFromInput() {
      const inp = document.getElementById('newStoreInput');
      const val = inp.value ? inp.value.trim() : '';
      if (!val) { alert('Inserisci il nome del supermercato'); return; }
      const ok = app.addStore(val);
      if (!ok) {
        alert('Questo supermercato √® gi√† presente o nome non valido.');
        return;
      }
      inp.value = '';
      renderStoresList();
      app.populateAllStoreSelects();
    }

    document.addEventListener('DOMContentLoaded', () => {
      // render della lista
      renderStoresList();

      document.getElementById('addStoreBtn')?.addEventListener('click', e => {
        e.preventDefault();
        addNewStoreFromInput();
      });

      document.getElementById('newStoreInput')?.addEventListener('keydown', e => {
        if (e.key === 'Enter') { e.preventDefault(); addNewStoreFromInput(); }
      });

      document.getElementById('saveSettingsBtn')?.addEventListener('click', () => {
        // salvataggio gi√† effettuato automaticamente, ma confermiamo
        app.saveStores(app.getStores());
        alert('Impostazioni salvate.');
      });

      document.getElementById('resetDefaultsBtn')?.addEventListener('click', () => {
        if (!confirm('Ripristinare la lista dei supermercati ai valori predefiniti?')) return;
        app.saveStores(app.defaultStores.slice());
        // forziamo reload della lista in memoria e UI
        app.stores = app.loadStores();
        renderStoresList();
        app.populateAllStoreSelects();
        alert('Valori predefiniti ripristinati.');
      });
    });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‚öôÔ∏è Impostazioni - Gestione Spese</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="" crossorigin="anonymous">

  <link rel="stylesheet" href="style.css" />
  <meta name="theme-color" content="#1e1e1e" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Impostazioni</h1>
    <nav class="top-nav" role="navigation" aria-label="Menu principale">
      <a href="index.html">Dashboard</a>
      <a href="aggiungi.html">Aggiungi</a>
      <a href="archivio.html">Archivio</a>
      <a href="impostazioni.html" class="nav-active">Impostazioni</a>
    </nav>
  </header>

  <main>
    <section class="settings-section">
      <h2>Supermercati</h2>
      <p class="hint">Rimuovi i supermercati che non usi o aggiungine di nuovi. Le modifiche vengono salvate automaticamente.</p>

      <div id="storesContainer" class="stores-list" aria-live="polite"></div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
        <input id="newStoreInput" class="store-input" type="text" placeholder="Aggiungi nuovo supermercato" />
        <button id="addStoreBtn" class="add-store-btn">‚ûï Aggiungi</button>
      </div>

      <div class="form-actions" style="margin-top:12px;">
        <button id="resetDefaultsBtn" class="btn btn-secondary">Ripristina valori predefiniti</button>
        <button id="saveSettingsBtn" class="save-settings-btn">üíæ Salva impostazioni</button>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
  <script>
    function renderStoresList() {
      const container = document.getElementById('storesContainer');
      container.innerHTML = '';
      const stores = app.getStores();
      if (!stores || stores.length === 0) {
        container.innerHTML = '<div class="no-expenses">Nessun supermercato salvato</div>';
        return;
      }

      stores.forEach(storeName => {
        const item = document.createElement('div');
        item.className = 'store-item';
        item.dataset.store = storeName;

        const handle = document.createElement('div');
        handle.className = 'store-handle';
        handle.title = 'Trascina per riordinare (non implementato)';
        handle.textContent = '‚â°';

        const input = document.createElement('input');
        input.className = 'store-input';
        input.value = storeName;
        input.readOnly = true;

        const actions = document.createElement('div');
        actions.className = 'store-actions';

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.title = 'Rimuovi';
        removeBtn.innerHTML = 'üóëÔ∏è';
        removeBtn.addEventListener('click', () => {
          if (confirm(`Eliminare "${storeName}" dalla lista dei supermercati?`)) {
            app.removeStore(storeName);
            renderStoresList();
            app.populateAllStoreSelects();
          }
        });

        actions.appendChild(removeBtn);
        item.appendChild(handle);
        item.appendChild(input);
        item.appendChild(actions);
        container.appendChild(item);
      });
    }

    function addNewStoreFromInput() {
      const inp = document.getElementById('newStoreInput');
      const val = inp.value ? inp.value.trim() : '';
      if (!val) { alert('Inserisci il nome del supermercato'); return; }
      const ok = app.addStore(val);
      if (!ok) { alert('Questo supermercato √® gi√† presente o non valido.'); return; }
      inp.value = '';
      renderStoresList();
      app.populateAllStoreSelects();
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderStoresList();

      document.getElementById('addStoreBtn')?.addEventListener('click', e => { e.preventDefault(); addNewStoreFromInput(); });
      document.getElementById('newStoreInput')?.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addNewStoreFromInput(); } });

      document.getElementById('saveSettingsBtn')?.addEventListener('click', () => { app.saveStores(app.getStores()); alert('Impostazioni salvate.'); });

      document.getElementById('resetDefaultsBtn')?.addEventListener('click', () => {
        if (!confirm('Ripristinare la lista ai valori predefiniti?')) return;
        app.saveStores(app.defaultStores.slice());
        app.stores = app.loadStores();
        renderStoresList();
        app.populateAllStoreSelects();
        alert('Valori predefiniti ripristinati.');
      });
    });
  </script>

  <!-- bottom navigation -->
  <nav class="bottom-nav" role="navigation" aria-label="Barra di navigazione">
    <a class="nav-item" href="index.html" aria-label="Dashboard">
      <span class="icon-wrap"><i class="fa-solid fa-chart-pie"></i></span>
      <span class="label">Dashboard</span>
    </a>
    <a class="nav-item" href="aggiungi.html" aria-label="Aggiungi">
      <span class="icon-wrap"><i class="fa-solid fa-plus-circle"></i></span>
      <span class="label">Aggiungi</span>
    </a>
    <a class="nav-item" href="archivio.html" aria-label="Archivio">
      <span class="icon-wrap"><i class="fa-solid fa-box-archive"></i></span>
      <span class="label">Archivio</span>
    </a>
    <a class="nav-item nav-active" href="impostazioni.html" aria-label="Impostazioni">
      <span class="icon-wrap"><i class="fa-solid fa-gear"></i></span>
      <span class="label">Impostazioni</span>
    </a>
  </nav>

  <script>
    (function () {
      const path = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.bottom-nav .nav-item').forEach(a => {
        const href = a.getAttribute('href') || '';
        if (href.endsWith(path)) a.classList.add('nav-active'); else a.classList.remove('nav-active');
      });
    })();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aggiungi Spesa</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#1e1e1e" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <header>
        <h1>üõçÔ∏è Aggiungi Spesa</h1>
        <nav>
            <a href="index.html">Dashboard</a>
            <a href="aggiungi.html" class="nav-active">Aggiungi</a>
            <a href="archivio.html">Archivio</a>
            <a href="impostazioni.html">Impostazioni</a>
        </nav>
    </header>

    <main class="add-expense">
        <form id="expenseForm" class="expense-form" novalidate>
            <div class="form-section">
                <h2>üè™ Informazioni Generali</h2>
                
                <div class="form-group">
                    <label for="storeSelect">Supermercato:</label>
                    <select id="storeSelect" required></select>
                </div>

                <div class="form-group" id="customStoreGroup" style="display: none;">
                    <label for="customStore">Nome supermercato:</label>
                    <input type="text" id="customStore" placeholder="Inserisci nome supermercato" />
                </div>

                <div class="form-group">
                    <label for="expenseDate">Data:</label>
                    <input type="date" id="expenseDate" required />
                </div>
            </div>

            <div class="form-section">
                <h2>üõí Aggiungi Prodotti</h2>
                
                <div class="product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productCategory">Tipologia:</label>
                            <select id="productCategory" required>
                                <option value="">Seleziona tipologia</option>
                                <option value="Carne">ü•© Carne</option>
                                <option value="Pesce">üêü Pesce</option>
                                <option value="Verdura">ü•¨ Verdura</option>
                                <option value="Frutta">üçé Frutta</option>
                                <option value="Latticini">üßÄ Latticini</option>
                                <option value="Pane">üçû Pane e Cereali</option>
                                <option value="Bevande">ü•§ Bevande</option>
                                <option value="Surgelati">üßä Surgelati</option>
                                <option value="Dolci">üç∞ Dolci</option>
                                <option value="Pulizia">üßΩ Prodotti Pulizia</option>
                                <option value="Igiene">üß¥ Igiene Personale</option>
                                <option value="Altro">üì¶ Altro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="productName">Nome prodotto:</label>
                            <input type="text" id="productName" placeholder="Es. Pomodori" required />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="productPrice">Prezzo (‚Ç¨):</label>
                            <input type="number" id="productPrice" step="0.01" min="0" inputmode="decimal" placeholder="0.00" required />
                        </div>

                        <div class="form-group">
                            <label for="productPriceKg">Prezzo/kg (‚Ç¨):</label>
                            <input type="number" id="productPriceKg" step="0.01" min="0" inputmode="decimal" placeholder="0.00" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="productNotes">Note:</label>
                        <input type="text" id="productNotes" placeholder="Note aggiuntive (opzionale)" />
                    </div>

                    <button type="button" id="addProductBtn" class="btn btn-secondary">
                        ‚ûï Aggiungi Prodotto al Carrello
                    </button>
                </div>
            </div>

            <div class="cart-section" id="cartSection" style="display: none;">
                <h2>üõí Carrello</h2>
                <div class="cart-table-container">
                    <table id="cartTable">
                        <thead>
                            <tr>
                                <th>Prodotto</th>
                                <th>Prezzo</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="cartBody"></tbody>
                    </table>
                </div>
                <div class="cart-total">
                    <strong>Totale: <span id="cartTotal">‚Ç¨0.00</span></strong>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" id="saveExpenseBtn" class="btn btn-primary" disabled>
                    üíæ Salva Spesa Completa
                </button>
                <button type="button" id="clearCartBtn" class="btn btn-danger">
                    üóëÔ∏è Svuota Carrello
                </button>
            </div>
        </form>
    </main>

    <script src="app.js"></script>
    <script>
    function populateStoreSelect() {
        const storeSelect = document.getElementById('storeSelect');
        if (!storeSelect || !app) return;
        storeSelect.innerHTML = '<option value="">Seleziona supermercato</option>';
        app.stores.forEach(store => {
            storeSelect.innerHTML += `<option value="${store}">${store}</option>`;
        });
        storeSelect.innerHTML += '<option value="Altro">Altro (specificare sotto)</option>';
    }

    function toggleCustomStore() {
        const storeSelect = document.getElementById('storeSelect');
        const customStoreGroup = document.getElementById('customStoreGroup');
        if (storeSelect.value === 'Altro') {
            customStoreGroup.style.display = 'block';
            document.getElementById('customStore').required = true;
        } else {
            customStoreGroup.style.display = 'none';
            document.getElementById('customStore').required = false;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('expenseDate').value = today;

        populateStoreSelect();
        document.getElementById('storeSelect').addEventListener('change', toggleCustomStore);
    });
    </script>
</body>
</html>